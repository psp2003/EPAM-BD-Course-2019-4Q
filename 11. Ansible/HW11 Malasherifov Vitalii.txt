#v1 - v1.local 192.168.182.3 CentOS7
#v2 - v2.local 192.168.182.4 CentOS7
#v3 - v3.local 192.168.182.5 CentOS7
 
#v1
yum install -y python3 ansible

#add to /etc/ansible/hosts :
	[hw-ansible]
	v[2:3].local

#Generate .pub ssh-key on v1 + copy to v2/v3
	ssh-keygen
	ssh-copy-id -i ~/.ssh/id_rsa.pub root@v2.local
	ssh-copy-id -i ~/.ssh/id_rsa.pub root@v3.local

#check connection
	[root@v1 .ssh]# ansible hw-ansible -m ping
	v2.local | SUCCESS => {
		"changed": false,
		"ping": "pong"
	}
	v3.local | SUCCESS => {
		"changed": false,
		"ping": "pong"

#playbook

	- hosts: hw-ansible
	  tasks:

	  - name: Create user+ssh-keys 
		user:
		  name: ansible
		  group: wheel
		  generate_ssh_key: yes
		  ssh_key_bits: 2048
		  ssh_key_file: .ssh/id_rsa

	  - name: copying ssh-keys
		authorized_key:
		  user: ansible
		  key: "{{lookup('file', '/home/ansible/.ssh/id_rsa.pub') }}"

	  - name: updates all packages on the systems
		yum:
		  name=*
		  state=latest

	#install epel-release for nginx
	  - name: dload MySQL
		get_url:
		  url: https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
		  dest: /root/mysql.rpm

	  - name: install ntp, nginx, MySQL
		yum:
		  name:
			- epel-release
			- ntp
			- nginx
			- /root/mysql.rpm
			- mysql-server
		  state: present
		
	#iburst for accuracy
	  - name: replace ntp config
		blockinfile:
		  path: /etc/ntp.conf
		  block: |
			server ntp2.stratum2.ru iburst

	#Before doing operation with MySQL, reset pass on MySQL
	  - name: Reset pass on MySQL
		shell: systemctl stop mysqld && echo "UPDATE mysql.user SET password='123456789_RoOt' WHERE user='root';" >> /root/init && systemctl start mysqld
		  
	#  - name: create mysql database

	#  - name: create mysql user

